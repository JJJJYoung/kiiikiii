<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pulse Animation with Motion Status</title>
  <link rel="stylesheet" href="./output.css">
  <style>
    /* í„ìŠ¤ ë§ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .pulse-ring {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: #ef4444;
      opacity: 0;
      pointer-events: none;
    }

    /* ì´ˆê¸° ìƒíƒœ: ì• ë‹ˆë©”ì´ì…˜ ì—†ìŒ */
    .pulse-ring.inactive {
      animation: none;
      opacity: 0;
    }

    /* í™œì„± ìƒíƒœ: ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ */
    .pulse-ring.active {
      opacity: 0.75;
      animation: var(--animate-custom-ping);
    }

    .status-transition {
      transition: all 0.3s ease-in-out;
    }
  </style>
</head>
<body class="bg-teal-50 h-screen flex items-center justify-center p-4">
  <div class="relative w-80 h-80" id="pulseContainer">
    <!-- í„ìŠ¤ ë§ë“¤ - ì´ˆê¸°ì—ëŠ” inactive ìƒíƒœ -->
    <span class="pulse-ring inactive" style="animation-delay: 0s;"></span>
    <span class="pulse-ring inactive" style="animation-delay: 0.5s;"></span>
    <span class="pulse-ring inactive" style="animation-delay: 1s;"></span>
    <span class="pulse-ring inactive" style="animation-delay: 1.5s;"></span>
    
    <div id="centralCircle" class="absolute w-full h-full rounded-full bg-purple-200 flex flex-col items-center justify-center status-transition shadow-lg">
      <div class="text-center space-y-4">
        <p class="text-xl text-gray-600 font-bold">ğŸ‘€ ì›€ì§ì„ ê°ì§€ ìƒíƒœ ğŸ‘€</p>
        
        <div id="motionStatus" class="text-3xl font-bold text-gray-800 status-transition">
          ìƒíƒœ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>
        
        <div class="text-xs text-gray-600 text-center mt-4 px-4">
          ESP-32 + HC-SR501 í”„ë¡œì íŠ¸<br>
          Team kiiikiii
        </div>
        
        <!-- ìƒíƒœ í‘œì‹œ ì•„ì´ì½˜ -->
        <div id="statusIcon" class="text-4xl status-transition">â³</div>
      </div>
    </div>
  </div>

  <!-- ì—°ê²° ìƒíƒœ í‘œì‹œ -->
  <div id="connectionStatus" class="fixed top-4 right-4 px-3 py-1 rounded-full text-sm font-medium bg-gray-200 text-gray-600">
    ì—°ê²° ì¤‘...
  </div>

  <script>
    let isMotionDetected = false;
    let isConnected = false;

    async function loadData() {
      const statusDiv = document.getElementById('motionStatus');
      const statusIcon = document.getElementById('statusIcon');
      const centralCircle = document.getElementById('centralCircle');
      const connectionStatus = document.getElementById('connectionStatus');
      const pulseElements = document.querySelectorAll('.pulse-ring');

      try {
        // API í˜¸ì¶œ
        const response = await fetch('/api/get-motion-status');
        const data = await response.json();

        isConnected = true;
        connectionStatus.textContent = 'ì—°ê²°ë¨';
        connectionStatus.className = 'fixed top-4 right-4 px-3 py-1 rounded-full text-sm font-medium bg-green-200 text-green-800';

        if (data.status === "detected") {
          // ì›€ì§ì„ ê°ì§€ ìƒíƒœ
          if (!isMotionDetected) {
            isMotionDetected = true;
            
            statusDiv.textContent = "ğŸš¨ ì›€ì§ì„ ê°ì§€!";
            statusDiv.className = 'text-3xl font-bold text-red-500 status-transition';
            statusIcon.textContent = 'ğŸ”´';
            
            centralCircle.className = 'absolute w-full h-full rounded-full bg-red-200 flex flex-col items-center justify-center status-transition shadow-lg';
            
            // í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            pulseElements.forEach(element => {
              element.classList.remove('inactive');
              element.classList.add('active');
            });
          }
          
        } else {
          // ì•ˆì „ ìƒíƒœ
          if (isMotionDetected) {
            isMotionDetected = false;
            
            statusDiv.textContent = "âœ… ì•ˆì „";
            statusDiv.className = 'text-3xl font-bold text-green-500 status-transition';
            statusIcon.textContent = 'ğŸŸ¢';
            
            centralCircle.className = 'absolute w-full h-full rounded-full bg-purple-200 flex flex-col items-center justify-center status-transition shadow-lg';
            
            // í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì •ì§€
            pulseElements.forEach(element => {
              element.classList.remove('active');
              element.classList.add('inactive');
            });
          }
        }

      } catch (error) {
        // ì—ëŸ¬ ì²˜ë¦¬
        isConnected = false;
        connectionStatus.textContent = 'ì—°ê²° ì‹¤íŒ¨';
        connectionStatus.className = 'fixed top-4 right-4 px-3 py-1 rounded-full text-sm font-medium bg-red-200 text-red-800';
        
        statusDiv.textContent = "âš ï¸ ì—°ê²° ì˜¤ë¥˜";
        statusDiv.className = 'text-3xl font-bold text-gray-500 status-transition';
        statusIcon.textContent = 'âŒ';
        
        centralCircle.className = 'absolute w-full h-full rounded-full bg-gray-200 flex flex-col items-center justify-center status-transition shadow-lg';
        
        // ì—ëŸ¬ ì‹œ í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì •ì§€
        pulseElements.forEach(element => {
          element.classList.remove('active');
          element.classList.add('inactive');
        });
        
        console.error('Motion detection error:', error);
      }
    }

    // ì´ˆê¸° ë¡œë“œ ë° ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
    loadData();
    const intervalId = setInterval(loadData, 2000);

    // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
    window.addEventListener('beforeunload', () => {
      clearInterval(intervalId);
    });
  </script>
</body>
</html>